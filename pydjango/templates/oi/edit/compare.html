{% extends "oi/base_view.html" %}

{% load display %}

{% block title %}
GCD :: Compare :: {{ changeset_type|title }} :: {{ revision }}
{% endblock %}

{% block css %}
<link rel="stylesheet" type="text/css"
      href="{{ MEDIA_URL }}css/gcd/default.css">
<link rel="stylesheet" type="text/css"
      href="{{ MEDIA_URL }}css/oi/default.css">
<link rel="stylesheet" type="text/css"
      href="{{ MEDIA_URL }}css/oi/default/edit.css">
{% endblock %}

{% block view_body %}
<h1>
{{ changeset|header_link }}
</h1>
<p>
Highlighted fields represent <span class="added_highlight">added</span>, 
<span class="comparison_highlight">changed</span>, and 
<span class="deleted_highlight">deleted</span> data.
{% if changeset.state != states.APPROVED and not revision.deleted %}
<a class="new_window" href="{% url preview_revision model_name=model_name,id=revision.id %}" target=_blank>Preview changes</a>
{% endif %}
{% if changeset_type == 'issue' %}
  {% if changeset.storyrevisions.count and not revision.deleted %}
    {% if request.GET.collapse %}
    <a href="{% url compare id=changeset.id %}">Expand compare view</a>.
    {% else %}
    <a href="{% url compare id=changeset.id %}?collapse=1">Collapse compare view</a>.
    {% endif %}
  {% endif %}
  {% include 'oi/bits/compare_issue.html' %}
  {% if changeset.change_type == CTYPES.variant_add %}
    {% if revision.ordered_story_revisions.0.source %}
<h2>
The above sequence was moved from the following issue.
</h2>
    {% endif %}
<div>
    {% for cover in changeset.coverrevisions.all %}
<h3>Cover is moved from {{ cover.issue }}.</h3>
      {{ cover.cover|cover_image_tag:'1, moved_cover' }}
    {% endfor %}
</div>
<hr>
    {% with changeset.issuerevisions.all.1 as revision %}
    {% with revision.previews as prev_rev %}
    {% with revision.posterior as post_rev %}
<h2>
      {{ revision }}
</h2>
        {% if changeset.state != states.APPROVED and not revision.deleted %}
<a class="new_window" href="{% url preview_revision model_name=model_name,id=revision.id %}" target=_blank>Preview changes</a>
        {% endif %}
      {{ revision.compare_changes|default:'' }}
      {% include 'oi/bits/compare_issue.html' %}
    {% endwith %}
    {% endwith %}
    {% endwith %}
  <!-- end of variant_add -->
  {% endif %}
{% else %}
</p>

  {% include 'oi/bits/compare.html' %}
{% endif %}

<h3> Comments </h3>

{% with changeset.comments as comments %}
{% include 'oi/bits/comments.html' %}
{% endwith %}

{% include 'oi/bits/compare_actions.html' %}

{% endblock %}

