{% extends "gcd/base_view.html" %}

{% load i18n %}
{% load credits %}

{% block title %} GCD :: Series :: {{ series.name }} {% endblock %}

{% block css %}
<link rel="stylesheet" type="text/css"
      href="{{ MEDIA_URL }}/css/gcd/{{ style|default:'default' }}.css">
</link>
<link rel="stylesheet" type="text/css"
      href="{{ MEDIA_URL }}/css/gcd/{{ style|default:'default' }}/series.css">
</link>
<link rel="stylesheet" type="text/css"
      href="{{ MEDIA_URL }}/css/gcd/{{ style|default:'default' }}/status.css">
</link>
<link rel="stylesheet" type="text/css"
      href="{{ MEDIA_URL }}/css/gcd/{{ style|default:'default' }}/scans.css">
</link>
{% endblock %}

{% block view_body %}

{% include "gcd/bits/series_issue_header.html" %}

{% if not preview %}
<div class="control_panel">
{% if series.reserved %}
  {% with series.revisions.all.0 as revision %}
    <div id="index_status" class="index_status_{{ revision.state }}">
    <span>
    {% ifequal revision.state 1 %}
       This {% if series.is_imprint %}imprint{% else %}series{% endif %}
        is currently being edited by
       {{ revision.indexer.indexer|default:"[no one, please contact the editors to fix this reservation]" }}
       (since {{ revision.created }}, last edit {{ revision.modified }})
    {% endifequal %}
    {% ifequal revision.state 2 %}
       Edits to this
       {% if series.is_imprint %}imprint{% else %}series{% endif %}
        are currently awaiting approval.
    {% endifequal %}
    </span>
    </div>
  {% endwith %}
{% else %}
  <form method="POST"
        action="{% url reserve_series id=series.id %}">
    <input id="edit" name="edit" type="submit" value="Edit" />
  </form>
{% endif %}

{% if series.is_current %}
  <div class="ongoing_status">
    The ongoing issue reservation for this series is held by
    {{ series.ongoing_reservation.indexer.indexer }}.
    No one else may currently add issues.
  </div>
  {% ifequal user series.ongoing_reservation.indexer %}
    <form method="POST"
          action="{% url add_issues series_id=series.id %}">
      <input id="add" name="add" type="submit" value="Add issues" />
    </form>
  {% endifequal %}
{% else %}
{% if series.ongoing_reservation %}
    <form method="POST"
          action="{% url apps.oi.views.ongoing %}">
      <input id="series" name="series" type="hidden" value="{{ series.id }}" />
      <input id="reserve" name="reserve" type="submit" value="Reserve all new issues" />
    </form>
{% endif %} <!-- series.is_current -->
    <form method="POST"
          action="{% url add_issues series_id=series.id %}">
      <input id="add" name="add" type="submit" value="Add issues" />
    </form>
{% endif %} <!-- series.ongoing_reservation -->
{% endif %} <!-- not preview -->

<div class="clear">
{% if series.has_gallery %}
<div id="series_cover">
  {{ image_tag }}
<p>
<a href="{{ series.get_absolute_url }}covers/?style={{ style|default:'default' }}">See cover gallery</a>
</p>
</div>
{%endif %}

<div id="series_data">
<dl>
  {% if series.publication_dates %}
  <dt> Publication Dates:
  <dd id="publication_dates"> {{ series.publication_dates }}
  {% endif %}
  {% if series.first_issue %}
  <dt> Number of Issues Published:
  <dd id="issues_published"> {{ series.issue_set.count }}
  {% endif %}

  {% if country %}
  <dt> Country:
  <dd id="publication_country"> {{ country }}
  {% endif %}
  {% if language %}
  <dt> Language:
  <dd id="publication_language"> {{ language }}
  {% endif %}
  {% if series.format %}
  <dt class="long"> Format:
  <dd id="series_format"> {{ series.format }}
  {% endif %}
</dl>

<div id="series_notes">
  {% if series.publication_notes %}
    <h3 class="series_notes"> Publication Notes </h3>
    <p> {{ series.publication_notes|linebreaksbr }}</p>
  {% endif %}
  
  {% if series.tracking_notes %}
    <h3 class="series_notes"> Tracking </h3>
    <p>{{ series.tracking_notes|linebreaksbr }}</p>
  {% endif %}
  
  {% if series.notes %}
    <h3 class="series_notes"> Title Notes </h3>
    <p>{{ series.notes|linebreaksbr }}</p>
  {% endif %}
</div> <!-- series_notes -->

{% if series.indexers %}
  <div id="index_credits">
    <h3 id="indexers_header">{% trans "Indexed by:" %}</h3>
    <ul>
      {% for credit in series.index_credit_set.all %}
        <li> {{ credit.indexer.name }}
      {% endfor %}
    </ul>
  </div> <!-- index_credits -->
{% endif %}
</div> <!-- series_data -->
</div> <!-- class="clear" -->

<hr/>

<h3> Index Status </h3>

{% include "gcd/bits/status_tables.html" %}
<hr/>

<h3> Cover Status </h3>

{% include "gcd/bits/scan_tables.html" %}

{% endblock %}

